<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aetheria Chronicle - Official News Hub</title>
    <!-- Load Tailwind CSS from CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles to enhance the dark/sci-fi feel */
        body {
            font-family: 'Inter', sans-serif;
            background-image: radial-gradient(at center 50%, #111827 0%, #030712 100%);
            min-height: 100vh;
        }
        .news-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .news-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 200, 255, 0.2);
        }
        .glow-button {
            transition: all 0.3s ease;
        }
        .glow-button:hover {
            box-shadow: 0 0 15px rgba(0, 200, 255, 0.7);
        }
        /* Style for editable areas in Admin Mode */
        .edit-highlight:hover {
            outline: 2px dashed #00bfff;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-gray-900 text-white">

    <!-- Global Loading Indicator -->
    <div id="loading-overlay" class="fixed inset-0 bg-gray-900/90 z-[100] flex items-center justify-center transition-opacity duration-300">
        <div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-cyan-500"></div>
        <p class="ml-4 text-cyan-400">Initializing Core Systems...</p>
    </div>

    <!-- Navigation Header -->
    <header class="sticky top-0 z-50 bg-gray-900/90 backdrop-blur-sm shadow-xl border-b border-cyan-800/50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <!-- Logo/Title -->
            <a href="#" class="text-3xl font-extrabold tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-sky-600">
                Aetheria Chronicle
            </a>
            <!-- Desktop Navigation Links and Admin Button -->
            <div class="flex items-center space-x-6">
                <nav class="hidden md:flex space-x-8">
                    <a href="#news" class="text-gray-300 hover:text-cyan-400 transition duration-150">News Feed</a>
                    <a href="#updates" class="text-gray-300 hover:text-cyan-400 transition duration-150">Patch Notes</a>
                    <a href="#media" class="text-gray-300 hover:text-cyan-400 transition duration-150">Media Hub</a>
                    <a href="#" class="text-gray-300 hover:text-cyan-400 transition duration-150">Roadmap</a>
                </nav>
                <button id="auth-button" class="glow-button px-4 py-2 text-sm font-semibold rounded-lg bg-cyan-600 hover:bg-cyan-700 text-gray-900 transition">
                    Loading...
                </button>
            </div>
            <!-- Mobile Menu Placeholder -->
            <button class="md:hidden text-gray-300 hover:text-cyan-400">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
            </button>
        </div>
    </header>

    <!-- Floating Admin Edit Button (Only visible to Admin) -->
    <button id="admin-toggle-button" class="hidden fixed bottom-6 right-6 z-40 p-4 rounded-full bg-red-600 text-white shadow-2xl hover:bg-red-700 transition glow-button">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
        </svg>
    </button>
    
    <!-- Main Content Container -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">

        <!-- Featured News Section (Hero) - Content is now loaded from Firestore -->
        <section id="featured" class="mb-16">
            <h1 class="text-5xl md:text-6xl font-black text-center mb-10 tracking-wider">
                <span class="text-cyan-400">Latest</span> Intel
            </h1>
            
            <div id="featured-article-container" class="relative bg-gray-800 rounded-2xl overflow-hidden shadow-2xl news-card min-h-64 flex items-center justify-center">
                <!-- Loading State for Featured Article -->
                <p class="text-gray-400">Loading Featured Article...</p>
                <!-- Content will be injected here -->
            </div>
        </section>

        <!-- News Feed Section (Hardcoded for now, waiting for database integration) -->
        <section id="news" class="mb-16">
            <h2 class="text-4xl font-bold border-b-2 border-cyan-500/50 pb-3 mb-8">
                Recent Transmissions
            </h2>
            
            <!-- News Grid (3x2 layout on desktop) -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                
                <!-- Article Card 1: PIM's Capital -->
                <div class="bg-gray-800 rounded-xl shadow-xl overflow-hidden news-card">
                    <img src="https://placehold.co/600x300/1f2937/d1d5db?text=Construction+of+PIM's+Capital" alt="Concept Art" class="w-full h-40 object-cover opacity-80">
                    <div class="p-6">
                        <span class="text-sm text-cyan-400 font-semibold mb-2 block">Construction of PIM's Capital</span>
                        <h3 class="text-xl font-bold mb-3 hover:text-cyan-400 transition cursor-pointer">
                            PabloEsCrabar Supreme building second city inside the PIM"
                        </h3>
                        <p class="text-gray-400 text-sm mb-4">
                            PabloEsCrabar has found a bug in the game that allows him to build multiple bases but a problem appeared. He didn't think that the new base would count as a base of another player which means the city won't appear for people to see.
                        </p>
                        <a href="#" class="text-cyan-500 hover:text-cyan-400 text-sm font-semibold">Would You like to know more? &rarr;</a>
                        <p class="text-xs text-gray-500 mt-4">October 19, 2025</p>
                    </div>
                </div>

                <!-- Article Card 2: System of Machines -->
                <div class="bg-gray-800 rounded-xl shadow-xl overflow-hidden news-card">
                    <img src="https://placehold.co/600x300/1f2937/d1d5db?text=A+system+full+of+machines" alt="Esports Team" class="w-full h-40 object-cover opacity-80">
                    <div class="p-6">
                        <span class="text-sm text-cyan-400 font-semibold mb-2 block">System of Machines</span>
                        <h3 class="text-xl font-bold mb-3 hover:text-cyan-400 transition cursor-pointer">
                            PabloEsCrabar has found a system not far from Aurelis full of robotic companions and sentinals
                        </h3>
                        <p class="text-gray-400 text-sm mb-4">
                            The system now Called "PIS" is in a few light years away from Aurelis and it is full of robotic ponies and assending to the sky sentinals
                        </p>
                        <a href="#" class="text-cyan-500 hover:text-cyan-400 text-sm font-semibold">Would You like to know more? &rarr;</a>
                        <p class="text-xs text-gray-500 mt-4">October 18, 2025</p>
                    </div>
                </div>

                <!-- Article Card 3: The Silencing -->
                <div class="bg-gray-800 rounded-xl shadow-xl overflow-hidden news-card">
                    <img src="https://placehold.co/600x300/1f2937/d1d5db?text=The+Silencing" alt="The Silencing" class="w-full h-40 object-cover opacity-80">
                    <div class="p-6">
                        <span class="text-sm text-cyan-400 font-semibold mb-2 block">The Silencing</span>
                        <h3 class="text-xl font-bold mb-3 hover:text-cyan-400 transition cursor-pointer">
                            Silencing of PIM
                        </h3>
                        <p class="text-gray-400 text-sm mb-4">
                            We and people from ABC have recognised such acts as an attempt to Silence PabloEsCrabar. PabloEsCrabar has Posted a few invites that were for The PIM and has followed every instruction except for reading the sixth rule and was warned 2 times and then banned after that He attempted to reapeal but recived only harrasments from "Mika" Mika was then executed for saying these things
                        </p>
                        <a href="#" class="text-cyan-500 hover:text-cyan-400 text-sm font-semibold">Would You like to know more?;</a>
                        <p class="text-xs text-gray-500 mt-4">October 15, 2025</p>
                    </div>
                </div>
                
                <!-- Article Card 4: Lore Deep Dive (New) -->
                <div class="bg-gray-800 rounded-xl shadow-xl overflow-hidden news-card">
                    <img src="https://placehold.co/600x300/1f2937/d1d5db?text=Lore+of+PIM+Dive" alt="Ancient Ruins" class="w-full h-40 object-cover opacity-80">
                    <div class="p-6">
                        <span class="text-sm text-cyan-400 font-semibold mb-2 block">Lore of PIM Dive</span>
                        <h3 class="text-xl font-bold mb-3 hover:text-cyan-400 transition cursor-pointer">
                            Discovering the lore of PIM's silencing
                        </h3>
                        <p class="text-gray-400 text-sm mb-4">
                            A look into the lore of PIM's and its silencing. A former Terrorist PabloEsCrabar has discovered that the game chose him as the discoverer of Aurel XI. He has attempted to start a new age for Aurel and tried stealing the throne. He tried to talk his way into the government of Aurel but failed misserably then starting a short civil war with the Govenor of Aurel XI MIST (a really cool guy btw) and after that They negotiated on Pablo Having the quarter of the planet, Pablo and Mist became friends after
                        </p>
                        <a href="#" class="text-cyan-500 hover:text-cyan-400 text-sm font-semibold">Would You like to know more? &rarr;</a>
                        <p class="text-xs text-gray-500 mt-4">September 14, 2025</p>
                    </div>
                </div>
            </div>

            <!-- Load More Button for the Archive feel -->
            <div class="mt-10 text-center">
                <a href="#" class="inline-flex items-center px-8 py-3 bg-gray-700 hover:bg-gray-600 text-white font-bold rounded-lg glow-button border border-cyan-500/50">
                    Load More Archived News
                </a>
            </div>
        </section>

        <!-- Dedicated Patch Notes Section -->
        <section id="updates" class="mb-16">
            <h2 class="text-4xl font-bold border-b-2 border-cyan-500/50 pb-3 mb-8">
                System Updates & Fixes
            </h2>
            
            <div class="space-y-6">
                <!-- Patch Note 1 -->
                <div class="bg-gray-800 p-6 rounded-xl shadow-lg news-card">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="text-2xl font-bold text-cyan-400">Introducing... No Mans's Sky: Voyagers</h3>
                        <span class="text-sm text-gray-500">August 27, 2025</span>
                    </div>
                    <!-- Note: The content here is extremely long. It's best practice to summarize in a news card, but keeping for now. -->
                    <ul class="list-disc list-inside text-gray-300 ml-4 space-y-2">
                        <li><span class="font-semibold text-red-400">[message]</span> Hello! I can’t believe it’s been just over nine years since No Man’s Sky first launched. No Man’s Sky VOYAGERS is what we’re super busy with right now and is one of our most ambitious updates. It launches today. Full patch notes are available here. https://youtu.be/qHZLz1MW0aE I’ve always loved Spaceships! Name a sci-fi film, book or game, and I want to talk to you about the spaceships in it! We know No Man’s Sky players feel the same - they spend countless hours searching the universe for their perfect ship. But what if you could design your own ship? If you could get out of your pilot's seat mid-flight and walk around? If you could invite your friends on board as crew? https://youtu.be/gdkt2rDKnAE I guess that’s always been the ultimate fantasy for us. An infinite universe to explore with your ship and crew. Something we’ve always wanted to see brought together in one game. Afterall perhaps the most important character in No Man’s Sky is your space ship. It’s your safe haven on hazardous planets, your companion exploring the stars. Your ship is your way of experiencing the universe, and when we change that, it really changes how the game feels. We call them Corvettes, huge ships with hulls, wings, landing gear, cockpits, engine parts, thrusters and more - arranged to your own unique sci-fi design. These ships have real interiors, med-bays, sleeping quarters, war rooms, radars, teleporters. It comes with you everywhere, which totally changes how you play. Decorating it with your friends gives you a space that you share together. Whether it's a brightly coloured tiny explorer, or a colossal dark metallic war ship, it allows you to show off your own personality. Adding bigger weapons to your Corvette increases your firepower. Add sleeping quarters, a nutrition unit and internal furnishings and you are ready to welcome a crew of friends on board. Add a mission radar and you are ready to adventure. A teleporter and you have an away team. Or just a window… and suddenly there are these special moments, watching as the universe flies by outside at warp speed. Having multiple Corvettes flying over a planet together is incredible, especially when you pop the hatch and spacewalk or skydive from one ship to the other! By design, Corvettes are encountered a little way into the game and veteran players will be able to unlock them reasonably swiftly. But we wanted to give all players a taste of what they can expect, so the accompanying “Corvette” expedition is specifically designed to get you to the workshop as quickly as possible and to take you on a journey which unlocks some of the parts you’re going to need to build out your sci-fi fantasy. The team at Hello have been working on Voyagers for a long time. The technical challenges they have had to overcome to make any of this possible have been immense. Almost every part of the game has had to be reworked to accommodate these relative spaces. Having your multiplayer crew walking around, calmly editing your ship, as it travels at warp speeds towards a planet that is being generated as you approach. It's pretty insane what's going on behind the scenes to make that work. Much of the technology we’re introducing with Voyagers is shared with our next game, Light No Fire, which is a truly open world, a shared Earth-sized planet, with real oceans to traverse, needing large boats and crews. We love that we get to share this technology with players early. You can wishlist Light No Fire here. https://youtu.be/jKQem4Z6ioQ The most exciting thing about Voyagers for me is the possibilities it opens in the future for No Man’s Sky, and I can’t wait to see where the team takes it from here. I can’t believe that in the past 12 months we released Worlds Part I, Worlds Part II, and Voyagers - all huge changes to this game we care about so much. To celebrate our ninth anniversary, we’re also releasing our latest range of No Man’s Sky merchandise that we hope you’ll enjoy, including:</li>
                    </ul>
                    <a href="#" class="text-cyan-500 hover:text-cyan-400 text-sm font-semibold mt-4 block">Would You like to know more? &rarr;</a>
                </div>

                <!-- Patch Note 2 -->
                <div class="bg-gray-800 p-6 rounded-xl shadow-lg news-card opacity-70">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="text-2xl font-bold text-gray-400">Patch 2.9.5 (Pre-Expansion)</h3>
                        <span class="text-sm text-gray-500">September 28, 2025</span>
                    </div>
                    <p class="text-gray-500 italic">This patch primarily prepared the client for the 3.0 content update.</p>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 border-t border-cyan-800/50 mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 text-center text-gray-400">
            <p>&copy; 2025 Aetheria Interactive. All Rights Reserved. | <a href="#" class="hover:text-cyan-400">Privacy Policy</a> | <a href="#" class="hover:text-cyan-400">Terms of Service</a></p>
            <p id="user-info" class="text-xs text-gray-600 mt-2">Status: Initializing...</p>
        </div>
    </footer>

    <!-- Admin Editing Modal (Hidden by Default) -->
    <div id="admin-modal" class="hidden fixed inset-0 z-50 bg-gray-900/90 backdrop-blur-sm flex items-center justify-center">
        <div class="bg-gray-800 p-8 rounded-xl shadow-2xl w-full max-w-lg border border-cyan-700/50">
            <h3 class="text-2xl font-bold mb-4 text-cyan-400">Edit Featured Article</h3>
            <p class="text-gray-400 mb-4">Edit the fields below. Saving will update the live site instantly.</p>
            
            <label class="block mb-2 text-sm font-semibold text-gray-300" for="edit-title">Title</label>
            <input id="edit-title" type="text" class="w-full p-2 mb-4 bg-gray-700 border border-gray-600 rounded-lg text-white" />

            <label class="block mb-2 text-sm font-semibold text-gray-300" for="edit-subtitle">Subtitle / Description</label>
            <textarea id="edit-subtitle" class="w-full p-2 mb-4 bg-gray-700 border border-gray-600 rounded-lg text-white h-24"></textarea>

            <div class="flex justify-end space-x-4 mt-6">
                <button id="modal-close" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg transition">Cancel</button>
                <button id="modal-save" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg transition glow-button">Save Changes</button>
            </div>
        </div>
    </div>


    <!-- Firebase/JS Setup -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Set Firebase logging level to Debug
        setLogLevel('Debug');

        // Global variables for Firebase setup
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'aetheria-news-app';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db;
        let auth;
        let currentUserId = null;
        let isAdmin = false;

        const featuredArticleDocPath = `/artifacts/${appId}/public/data/site_content/featured`;
        const adminConfigDocPath = `/artifacts/${appId}/public/data/admin_config/config`;

        // DOM Elements
        const loadingOverlay = document.getElementById('loading-overlay');
        const authButton = document.getElementById('auth-button');
        const adminToggleButton = document.getElementById('admin-toggle-button');
        const userInfo = document.getElementById('user-info');
        const featuredContainer = document.getElementById('featured-article-container');
        const adminModal = document.getElementById('admin-modal');
        const modalCloseButton = document.getElementById('modal-close');
        const modalSaveButton = document.getElementById('modal-save');
        const editTitle = document.getElementById('edit-title');
        const editSubtitle = document.getElementById('edit-subtitle');


        /**
         * Initializes Firebase and sets up the authentication listener.
         */
        async function initializeFirebase() {
            try {
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                // Try to sign in with the custom token, fallback to anonymous if not present
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                // Wait for auth state change to confirm user status
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        currentUserId = user.uid;
                        userInfo.textContent = `User ID: ${currentUserId.substring(0, 8)}... | Status: Authenticated`;
                        await checkAndSetAdmin();
                        setupRealtimeListeners();
                    } else {
                        currentUserId = null;
                        isAdmin = false;
                        userInfo.textContent = 'Status: Not Signed In';
                        updateUI();
                    }
                    // Hide loading after auth state is determined
                    loadingOverlay.style.opacity = '0';
                    setTimeout(() => loadingOverlay.classList.add('hidden'), 300);
                });

            } catch (error) {
                console.error("Firebase Initialization Error:", error);
                userInfo.textContent = `Error: ${error.message}`;
                loadingOverlay.style.opacity = '0';
                setTimeout(() => loadingOverlay.classList.add('hidden'), 300);
            }
        }

        /**
         * Checks if the current user is the admin, or sets the current user as admin
         * if no admin is configured yet.
         */
        async function checkAndSetAdmin() {
            if (!db || !currentUserId) return;

            const adminRef = doc(db, adminConfigDocPath);
            const adminSnap = await getDoc(adminRef);

            if (adminSnap.exists()) {
                const config = adminSnap.data();
                if (config.adminId === currentUserId) {
                    isAdmin = true;
                    console.log("Current user is Admin.");
                } else {
                    isAdmin = false;
                    console.log("Current user is not Admin.");
                }
            } else {
                // First user becomes admin
                console.log("No Admin configured. Setting current user as Admin.");
                await setDoc(adminRef, {
                    adminId: currentUserId,
                    appOwnerId: currentUserId
                });
                isAdmin = true;
            }
            updateUI();
        }

        /**
         * Sets up the real-time listener for the featured article content.
         */
        function setupRealtimeListeners() {
            if (!db) return;

            // 1. Featured Article Listener
            onSnapshot(doc(db, featuredArticleDocPath), (docSnapshot) => {
                if (docSnapshot.exists()) {
                    renderFeaturedArticle(docSnapshot.data());
                } else {
                    // Initialize default featured article content if none exists
                    const defaultContent = {
                        category: "Major Update",
                        title: "THE NEWS WEBSITE IS LIVE",
                        subtitle: "We are live and We will post the most interesting News from Aurel here. Submit Your stories in the https://discord.com/channels/1428077506287898778/1429800581446242471",
                        date: "October 20, 2025",
                        imageUrl: "https://placehold.co/1200x500/1e293b/94a3b8?text=THE+AUREL+NEWS+WEBSITE+LAUNCH"
                    };
                    setDoc(doc(db, featuredArticleDocPath), defaultContent);
                    renderFeaturedArticle(defaultContent);
                }
            });
        }

        /**
         * Renders the featured article in the hero section.
         * @param {Object} data - The article data from Firestore.
         */
        function renderFeaturedArticle(data) {
            featuredContainer.innerHTML = `
                <!-- Placeholder Image -->
                <img src="${data.imageUrl}" alt="Featured News Image" class="w-full h-64 md:h-96 object-cover opacity-80">
                
                <div class="absolute inset-0 bg-gradient-to-t from-gray-900/90 to-transparent"></div>
                
                <div class="p-6 md:p-10 absolute bottom-0 w-full">
                    <span id="f-category" class="inline-block bg-cyan-600 text-xs font-semibold px-3 py-1 rounded-full mb-3 uppercase tracking-wider edit-highlight" data-field="category">
                        ${data.category}
                    </span>
                    <h2 id="f-title" class="text-4xl md:text-5xl font-bold mb-3 leading-tight edit-highlight" data-field="title">
                        ${data.title}
                    </h2>
                    <p id="f-subtitle" class="text-gray-400 mb-6 max-w-3xl hidden sm:block edit-highlight" data-field="subtitle">
                        ${data.subtitle}
                    </p>
                    <a href="#" class="inline-flex items-center px-6 py-3 bg-cyan-500 hover:bg-cyan-600 text-gray-900 font-bold rounded-lg glow-button">
                        Read the News
                        <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
                    </a>
                    <p id="f-date" class="text-sm text-gray-500 mt-4 edit-highlight" data-field="date">Posted: ${data.date}</p>
                </div>
            `;
            // Add click listener to editable areas if in Admin mode
            if (isAdmin) {
                document.querySelectorAll('.edit-highlight').forEach(el => {
                    el.onclick = () => openEditModal(data);
                });
            }
        }


        /**
         * Updates the UI based on authentication and admin status.
         */
        function updateUI() {
            if (isAdmin) {
                authButton.textContent = 'Admin Mode (Logout)';
                authButton.onclick = () => signOut(auth);
                adminToggleButton.classList.remove('hidden');
                document.body.classList.add('admin-mode');
            } else if (currentUserId) {
                authButton.textContent = 'Logout';
                authButton.onclick = () => signOut(auth);
                adminToggleButton.classList.add('hidden');
                document.body.classList.remove('admin-mode');
            } else {
                authButton.textContent = 'Login';
                // Note: The anonymous login is handled on load.
                // If the user logs out, they stay logged out unless they refresh or we add a full login method.
                // For simplicity, we just keep the anonymous session active.
                authButton.onclick = () => alert("To gain admin access, please ask the app owner to grant you access by manually editing the Firebase database or simply refresh if you are the owner.");
            }
        }

        // --- Admin Modal Functionality ---

        function openEditModal(articleData) {
            // Populate modal with current data
            editTitle.value = articleData.title || '';
            editSubtitle.value = articleData.subtitle || '';
            
            adminModal.classList.remove('hidden');
            
            // Set save handler
            modalSaveButton.onclick = () => saveFeaturedArticle();
        }

        function closeEditModal() {
            adminModal.classList.add('hidden');
        }

        async function saveFeaturedArticle() {
            if (!isAdmin || !db) return;

            const newTitle = editTitle.value;
            const newSubtitle = editSubtitle.value;

            try {
                // Get the current document to preserve non-editable fields (like image URL)
                const docRef = doc(db, featuredArticleDocPath);
                await setDoc(docRef, {
                    title: newTitle,
                    subtitle: newSubtitle,
                    // Keep original date and category unless fields are added to modal
                }, { merge: true });

                alert("Article saved successfully! The page should update shortly.");
                closeEditModal();

            } catch (e) {
                console.error("Error saving document: ", e);
                alert("Error saving article. Check the console for details.");
            }
        }

        // Event Listeners for Modal
        modalCloseButton.onclick = closeEditModal;
        adminToggleButton.onclick = () => {
             // In a larger app, this would toggle a global edit mode.
             // Here, it just shows the modal for the primary content.
             // Fetch the current state of the featured article to populate the modal
             getDoc(doc(db, featuredArticleDocPath)).then(snap => {
                if (snap.exists()) {
                    openEditModal(snap.data());
                } else {
                    // Fallback to initial content if doc doesn't exist yet
                    openEditModal({ title: '', subtitle: '' });
                }
             });
        };

        // Initialize the app
        window.onload = initializeFirebase;
    </script>
</body>
</html>
